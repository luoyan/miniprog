/*! page - v1.0.0 - 2013-11-18 */
define("js/page/base",["jquery","jqueryplugins","Boxy"],function(a,b,c){function d(a){return/^(GET|HEAD|OPTIONS|TRACE)$/.test(a)}var e=a("jquery");a("jqueryplugins");var f=a("Boxy");if("undefined"==typeof g){var g={};window.MM=g}g.getCookie=function(a){var b=null;if(document.cookie&&""!=document.cookie)for(var c=document.cookie.split(";"),d=0;d<c.length;d++){var f=e.trim(c[d]);if(f.substring(0,a.length+1)==a+"="){b=decodeURIComponent(f.substring(a.length+1));break}}return b};var h=g.getCookie("csrftoken");e.ajaxSetup({crossDomain:!1,cache:!1,contentType:"application/x-www-form-urlencoded; charset=UTF-8",beforeSend:function(a,b){d(b.type)||a.setRequestHeader("X-CSRFToken",h)},ajaxError:function(a,b){0!==b.status&&alert(b.status)}}),g.ajaxPost=function(a,b,c){e.ajax({url:a,type:"post",dataType:"json",data:JSON.stringify(b),success:c})},g.parseDate=function(a){if("object"==typeof a)return a;if("string"==typeof a&&a.indexOf("-")){a.indexOf(" ")&&(a=a.split(" ")[0]);var b=a.split("-");return new Date(b[0],b[1]-1,b[2])}return new Date(a)},g.getOffsetDate=function(a,b){return a=g.parseDate(a),new Date(a.getTime()+24*b*3600*1e3)},g.diffDate=function(a,b){return a=g.parseDate(a),b=g.parseDate(b),a=new Date(a.getFullYear(),a.getMonth(),a.getDate()),b=new Date(b.getFullYear(),b.getMonth(),b.getDate()),(a.getTime()-b.getTime())/1e3/3600/24},g.formatDate=function(a,b){a=g.parseDate(a);var c=a.getMonth()+1;10>c&&(c="0"+c);var d=a.getDate();10>d&&(d="0"+d);var e=a.getHours();10>e&&(e="0"+e);var f=a.getMinutes();10>f&&(f="0"+f);var h=a.getSeconds();10>h&&(h="0"+h);var i="";switch(b){case"mm-dd":i=c+"-"+d;break;case"yyyy-mm":i=a.getFullYear()+"-"+c;break;case"yyyymmdd:hhmm":i=a.getFullYear()+"年"+(a.getMonth()+1)+"月"+a.getDate()+"日 "+e+":"+f;break;case"yyyy-mm-dd hh:mm":i=a.getFullYear()+"-"+c+"-"+d+" "+e+":"+f;break;case"yyyymmdd:hhmmss":i=a.getFullYear()+"-"+c+"-"+d+" "+e+":"+f+":"+h;break;case"mm-dd hhmmss":i=c+"-"+d+" "+e+":"+f+":"+h;break;case"hhmmss":i=e+":"+f+":"+h;break;case"mm/dd/yyyy":i=c+"/"+d+"/"+a.getFullYear();break;default:i=a.getFullYear()+"-"+c+"-"+d}return i},g.strlen=function(a){for(var b=0,c=0;c<a.length;c++){var d=a.charCodeAt(c);d>=1&&126>=d||d>=65376&&65439>=d?b++:b+=2}return b},g.cutstr=function(a,b){for(var c=0,d=0,e="",d=a.length,f=0;d>f;f++){var g=a.charAt(f);if(c++,escape(g).length>4&&c++,!(b>=c))return e;e=e.concat(g)}return c?a:e},function(a){function b(){e("#search_btn").click(function(){var a=e("#search_text").val();if(""==e.trim(a))a=e("#default_value").text();else if(g.strlen(a)>36)return alert("您搜索的关键词过长，请缩短到18个汉字或者36英文字符以内"),void 0;location.href="/search?q="+a}),e("#search_text").keydown(function(a){if(13==a.keyCode){var b=e("#search_text").val();if(""==e.trim(b))b=e("#default_value").text();else if(g.strlen(b)>36)return alert("您搜索的关键词过长，请缩短到18个汉字或者36英文字符以内"),void 0;location.href="/search?q="+b}}),e("#search_text").focusin(function(){e("#default_value").hide()}),e("#search_text").focusout(function(){""!=e("#search_text").val()?e("#default_value").hide():e("#default_value").show()}),e("#to_top").click(function(){h()}),e("#save_page").click(function(){return a.ajaxPost("/set_click_log",{type:"save_website"},function(){}),j.addFavorite("http://ztmhs.maimiaotech.com","真划算"),!1})}function c(){var b=e.cookie("od");b?a.ajaxPost("/get_user_gold_info",{id:b},function(a){var b=a.data.job["1"].con_num-0+1;b>7&&(b=7);var c=a.data.job["1"].num;if(e("#sign_in").attr("gold_data",b),c){e("#sign_in").addClass("disabled").text("已签到");var d='<div class="warn-tips-ctn"><h1>明天再来可以领取到<span class="warn">'+b+'</span>个金币</h1><p>连续领取天数越多获得的金币也越多最多不超过7个</p><div><a class="set-qqwarn" id="warn_tomorrow" target="_blank" href="'+j.signin_warn_url+'">点击添加明天签到提醒</a>(仅提醒一次)</div></div>';e("#sign_in").poshytip({content:d,className:"tip-gray",showTimeout:0,alignTo:"target",alignX:"center",offsetY:-5,live:!0,allowTipHover:!0}),e("#sign_in").val()}else{var d='<div class="tips-ctn">签到可以领取<span class="warn">'+b+"</span>个金币</div>";e("#sign_in").poshytip({content:d,className:"tip-gray",showTimeout:0,alignTo:"target",alignX:"center",offsetY:-5,live:!0,allowTipHover:!0})}}):e("#sign_in").poshytip({content:'<div class="tips-ctn">请先登录</div>',className:"tip-gray",showTimeout:0,live:!0,alignTo:"target",alignX:"center",offsetY:-5,allowTipHover:!0}),e("#sign_in").click(function(){return b?e(this).hasClass("disabled")||g.ajaxPost("/add_user_gold",{id:b,job_id:"1"},function(a){if(a.success){var b=e("#sign_in").attr("gold_data")-0,c=b+1;c>7&&(c=7);var d='<div class="warn-tips-ctn"><h1>明天再来可以领取到<span class="warn">'+c+'</span>个金币</h1><p>连续领取天数越多获得的金币也越多最多不超过7个</p><div><a class="set-qqwarn" id="warn_tomorrow" target="_blank" href="'+j.signin_warn_url+'">点击添加明天签到提醒</a>(仅提醒一次)</div></div>';if(e("#sign_in").poshytip("update",d),e("#sign_in").addClass("disabled").text("已签到"),e("#job_1")[0]){e("#job_1").parent().addClass("disabled");var f=e("#jifen").text()-0+b;e("#jifen").text(f),e("#signin_days").text(e("#signin_days").text()-0+1)}}}):location.href="https://graph.qq.com/oauth2.0/authorize?response_type=code&client_id=100523811&redirect_uri=http://ztmhs.maimiaotech.com/auth/login&scope=all",!1}),e("body").delegate(".set-qqwarn","click",function(){b&&g.ajaxPost("/add_user_gold",{id:b,job_id:"5"},function(a){a.success&&e("#job_5")[0]&&(e("#job_5").parent().addClass("disabled"),e("#jifen").text(e("#jifen").text()-0+3))})}),e(".qqqun").delegate("#addQQ","click",function(){b&&g.ajaxPost("/add_user_gold",{id:e.cookie("od"),job_id:"3"},function(a){a.success&&e("#job_3")[0]&&(e("#job_3").parent().addClass("disabled"),e("#jifen").text(e("#jifen").text()-0+10))})})}function d(){var a=e(window).width(),b=(a-960)/2-48;10>b&&(b=10),e("#side_bar_tools").css("right",b),e("#side_bar_tools").show(),e(window).scroll(function(){var a=e(window).scrollTop();a>500?e("#to_top").css("display","block"):e("#to_top").hide()})}function h(){l=setInterval(i,1)}function i(){currentPosition=document.documentElement.scrollTop||document.body.scrollTop,currentPosition-=200,currentPosition>0?window.scrollTo(0,currentPosition):(window.scrollTo(0,0),clearInterval(l))}var j={},k=g.formatDate(g.getOffsetDate(new Date,1))+" 10:00";j.signin_warn_url="http://qzs.qq.com/snsapp/app/bee/widget/open.htm#content=今天的签到时间到咯~快去签到吧~&time="+k+"&advance=0&url=http://ztmhs.maimiaotech.com/seckill",j.init=function(){d(),b(),c(),e("#set_qqwarn").attr("href",j.signin_warn_url)},j.addFavorite=function(a,b){try{window.external.addFavorite(a,b)}catch(c){try{window.sidebar.addPanel(a,b,"")}catch(c){new f("<div>请按 ctrl+D 进行收藏</div>",{modal:!0,title:" ",closeText:"×"})}}},j.addMask=function(){},j.deleteMask=function(){e(".mask").remove()},j.updateTime=function(a,b){if(e("#"+a)[0]){var c=b.getHours(),d=b.getMinutes(),f=b.getSeconds(),h=new Date,i=h.getHours(),l=h.getMinutes(),m=h.getSeconds(),n=c-i,o=d-l,p=f-m;if(0>p&&(p=60+p,o-=1),0>o&&(o=60+o,n-=1),0>n&&(n=24+n),b.getTime()-h.getTime()<=3e5&&e("#"+a).addClass("in5min"),h>=b)if(e("#"+a).removeClass("in5min"),e("#"+a).hasClass("upcoming")){e("#"+a+" .time-type").text("离结束:");var q=e("#"+a+" .timer").attr("end_time_stamp");e("#"+a+" .timer").text(g.formatDate(1e3*q,"hhmmss")),e("#"+a).removeClass("upcoming").addClass("normal");var r=new Date(1e3*q);setTimeout(function(){j.updateTime(a,r)},1e3)}else e("#"+a+" .time-type").text("已经结束"),e("#"+a+" .timer").text(""),k=g.formatDate(g.getOffsetDate(new Date,1))+" 10:00",warnurl="http://qzs.qq.com/snsapp/app/bee/widget/open.htm#content=今天的秒杀已经开始了，要知道好价格的商品可是稍纵即逝哦！&time="+k+"&advance=0&url=http://ztmhs.maimiaotech.com/seckill",e("#"+a+" .qqwarn a").attr("href",warnurl),e("#"+a).removeClass("normal").addClass("sellout");else e("#"+a+" .timer").text(n+"小时"+o+"分"+p+"秒"),setTimeout(function(){j.updateTime(a,b)},1e3)}};var l;a.comm=j}(g),e(function(){g.comm.init()}),c.exports=g});