/*! page - v1.0.0 - 2013-11-18 */
define("js/page/seckill",["./base","jquery","jqueryplugins","Boxy","myPagination"],function(a,b,c){function d(a,b,c,d){if(a.length>0){for(var e=0,g=a.length;g>e;e++)a[e].title=$.trim(a[e].title),a[e].cur_price=-1==a[e].cur_price?-1:a[e].cur_price/100,a[e].ori_price=-1==a[e].ori_price?-1:a[e].ori_price/100,a[e].discount=-1==a[e].discount?-1:a[e].discount/10;$(".sec-kill-items").html($("#seckillItemTmpl").tmpl(a)),h.initTimer(),b&&f(b,c,d)}else{var i=$(".kinds-ctn .on").text();if("一元秒杀"==i){var j,k=new Date(MM.formatDate(new Date,"mm/dd/yyyy")+" 09:40:00");j=k<new Date?MM.formatDate(MM.getOffsetDate(new Date,1))+" 9:35":MM.formatDate(new Date)+" 9:35";var l="http://qzs.qq.com/snsapp/app/bee/widget/open.htm#content=今天的1元秒杀还有5分钟就开始了，好价格的商品可是稍纵即逝哦！&time="+j+"&advance=0&url=http://www.ztmhs.com/seckill";$(".sec-kill-items").html('<div class="no-products">1元秒杀每天早上9点40分开始。<a href="'+l+'" target="_blank">设置QQ提醒</a></div>')}else $(".sec-kill-items").html('<div class="no-products">对不起该类目下，目前还没有商品</div>');$("#pagination").html("")}}function e(){$("#upcoming_btn").click(function(){if(!$(this).hasClass("on")){i=1,j=1;var a=$(".kinds-ctn .on").text();MM.ajaxPost("/ajax_get_seckills",{cat:a,page_num:1,req_type:i,order:j},function(b){d(b.data,i,j,a)}),$("#upcoming_btn").addClass("on"),$("#sellout_btn").removeClass("on"),$("#normal_btn").removeClass("on"),$("#normal_btn i").removeClass("asc desc").addClass("normal")}}),$("#sellout_btn").click(function(){if(!$(this).hasClass("on")){i=2,j=1;var a=$(".kinds-ctn .on").text();MM.ajaxPost("/ajax_get_seckills",{cat:a,page_num:1,req_type:i,order:j},function(b){d(b.data,i,j,a)}),$("#upcoming_btn").removeClass("on"),$("#sellout_btn").addClass("on"),$("#normal_btn").removeClass("on"),$("#normal_btn i").removeClass("asc desc").addClass("normal")}}),$("#normal_btn").click(function(){i=3;var a=$(".kinds-ctn .on").text();$(this).hasClass("on")?$("i",this).hasClass("asc")?(j=-1,MM.ajaxPost("/ajax_get_seckills",{cat:a,page_num:1,req_type:i,order:j},function(b){d(b.data,i,j,a)}),$("#normal_btn i").removeClass("asc normal").addClass("desc")):(j=1,MM.ajaxPost("/ajax_get_seckills",{cat:a,page_num:1,req_type:i,order:j},function(b){d(b.data,i,j,a)}),$("#normal_btn i").removeClass("normal desc").addClass("asc")):(j=1,MM.ajaxPost("/ajax_get_seckills",{cat:a,page_num:1,req_type:i,order:j},function(b){d(b.data,i,j,a)}),$("#upcoming_btn").removeClass("on"),$("#sellout_btn").removeClass("on"),$("#normal_btn").addClass("on"),$("#normal_btn i").removeClass("normal").addClass("asc"))}),$(".kinds-ctn span").click(function(){if(!$(this).hasClass("on")){var a=$(this).text();MM.ajaxPost("/ajax_get_seckills",{cat:a,page_num:1,req_type:i,order:j},function(b){d(b.data,i,j,a)}),$(".kinds-ctn span").removeClass("on"),$(this).addClass("on")}})}function f(a,b,c){MM.ajaxPost("/get_seckills_count",{cat:c},function(e){var f=e.data%40,h=Math.floor(e.data/40);$("#pagination").myPagination({cssStyle:"ztmhs",pageCount:f?h+1:h,pageNumber:10,ajax:{on:!1,onClick:function(e){$.cookie("newUser")||g.comm.addMask(),MM.ajaxPost("/ajax_get_seckills",{cat:c,page_num:e,req_type:a,order:b},function(a){d(a.data),$(window).scrollTop(0)})}}})})}var g=a("./base");a("myPagination");var h={},i=3,j=1;h.init=function(){e(),h.initTimer(),f($("#req_type").val()-0,j,$(".kinds-ctn .on").text())},h.initTimer=function(){$(".item").each(function(a,b){var c,d,e;if($(b).hasClass("upcoming")){c=$(".timer",b).attr("start_time_stamp");var f=MM.formatDate(1e3*c,"hhmmss");$(".starttime",b).text(f),$(".timer",b).text(f);var h=$(".desc",b).text();e=MM.formatDate(1e3*c,"yyyy-mm-dd hh:mm"),d="http://qzs.qq.com/snsapp/app/bee/widget/open.htm#content=”"+h+"“还有5分钟就要开始秒杀啦！GO！&time="+e+"&advance=5&url=http://ztmhs.maimiaotech.com/seckill?req_type=1"}else c=$(".timer",b).attr("end_time_stamp"),$(".timer",b).text(MM.formatDate(1e3*c,"hhmmss")),e=MM.formatDate(MM.getOffsetDate(new Date,1))+" 10:00",d="http://qzs.qq.com/snsapp/app/bee/widget/open.htm#content=今天的秒杀已经开始了，要知道好价格的商品可是稍纵即逝哦！&time="+e+"&advance=0&url=http://ztmhs.maimiaotech.com/seckill";$(".qqwarn a",b).attr("href",d);var i=$(b).attr("id"),j=new Date(1e3*c);g.comm.updateTime(i,j)})},c.exports=h});