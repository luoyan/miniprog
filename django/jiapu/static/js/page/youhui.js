/*! page - v1.0.0 - 2013-11-18 */
define("js/page/youhui",["./base","jquery","jqueryplugins","Boxy","myPagination"],function(require,exports,module){function genGuide(){$.cookie("youhui_guide")||($('<div class="mask"><div class="mask-ctn"></div><div class="guide-content"><img src="/static/images/youhui_guide.jpg" /></div></div>').appendTo("body"),$("body").delegate(".mask","click",function(){$(".mask").fadeOut("slow"),$.cookie("youhui_guide","true",{expires:365,path:"/"}),mm.ajaxPost("/add_count_flag",{flag:"youhui_guide"},function(){})}))}function initEvent(){$(".feeds-main").delegate(".type","click",function(){var a=$.trim($(this).text());return"白菜价"==a?(MM.ajaxPost("/ajax_get_feeds",{page_num:1,search_type:1},function(a){$(window).scrollTop(500),search_type=1,get_page_times=1,cur_page_no=1,isEnd=!1;var b=generateItems(a.data);$(".feeds-ctn").html($("#feedItemTmpl").tmpl(b)),$("#cheap").addClass("on"),$("#lowest, #salespromotion, #all").removeClass("on")}),setPaginaviBar(1)):"强烈值得买"==a?(MM.ajaxPost("/ajax_get_feeds",{page_num:1,search_type:2},function(a){$(window).scrollTop(500),search_type=2,get_page_times=1,cur_page_no=1,isEnd=!1;var b=generateItems(a.data);$(".feeds-ctn").html($("#feedItemTmpl").tmpl(b)),$("#lowest").addClass("on"),$("#cheap, #salespromotion, #all").removeClass("on")}),setPaginaviBar(2)):"促销活动"==a?(MM.ajaxPost("/ajax_get_feeds",{page_num:1,search_type:3},function(a){$(window).scrollTop(500),search_type=3,get_page_times=1,cur_page_no=1,isEnd=!1;var b=generateItems(a.data);$(".feeds-ctn").html($("#feedItemTmpl").tmpl(b)),$("#salespromotion").addClass("on"),$("#lowest, #cheap, #all").removeClass("on")}),setPaginaviBar(3)):"查看全部"==a&&(MM.ajaxPost("/ajax_get_feeds",{page_num:1,search_type:0},function(a){$(window).scrollTop(500),search_type=0,get_page_times=1,cur_page_no=1,isEnd=!1;var b=generateItems(a.data);$(".feeds-ctn").html($("#feedItemTmpl").tmpl(b)),$("#all").addClass("on"),$("#lowest, #cheap, #salespromotion").removeClass("on")}),setPaginaviBar(0)),!1}),$(".feeds-ctn").delegate(".deserve-icon","click",function(){var a=this,b=$(this).parent().attr("id");$.cookie(b)||MM.ajaxPost("/ajax_add_worth",{id:b},function(){var c=$(a).prev().text()-0+1,d=$(a).offset();$("<div class='add-one'></div>").css({top:d.top-20,left:d.left}).appendTo("body").fadeOut(1e3,function(){$(this).remove(),$(a).prev().text(c)}),$.cookie(b,"true"),$(a).parent().addClass("clicked")})}),$(".feeds-ctn").delegate(".undeserve-icon","click",function(){var a=this,b=$(this).parent().attr("id");$.cookie(b)||MM.ajaxPost("/ajax_add_bad",{id:b},function(){var c=$(a).prev().text()-0+1,d=$(a).offset();$("<div class='add-one'></div>").css({top:d.top-20,left:d.left}).appendTo("body").fadeOut(1e3,function(){$(this).remove(),$(a).prev().text(c)}),$.cookie(b,"true"),$(a).parent().addClass("clicked")})}),$(".feeds-ctn").delegate(".share-qqzone","click",function(){var user_id=$.cookie("od");user_id&&mm.ajaxPost("/add_user_gold",{id:user_id,job_id:"6"},function(){});var data=eval("("+$(this).parent().attr("data")+")"),s=[];return s.push("url="+encodeURIComponent(data.url||"")),s.push("desc="+encodeURIComponent(data.desc||"")),s.push("pics="+encodeURIComponent(data.pic||"")),s.push("title="+encodeURIComponent(data.title||"")),s.push("summary="+encodeURIComponent(data.text||"")),window.open("http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?"+s.join("&")),!1}),$(".feed-img-ctn li").hover(function(){var a=$(this).index();$(".feed-title-ctn li").removeClass("hover"),$(".feed-title-ctn li:eq("+a+")").addClass("hover")},function(){$(".feed-title-ctn li").removeClass("hover")}),$(".feed-title-ctn li").hover(function(){var a=$(this).index();$(".feed-img-ctn").addClass("hover"),$(".feed-img-ctn li").removeClass("hover"),$(".feed-img-ctn li:eq("+a+")").addClass("hover")},function(){$(".feed-img-ctn li").removeClass("hover"),$(".feed-img-ctn").removeClass("hover")}),$(".feeds-ctn").delegate(".toggle","click",function(){$(this).hasClass("toggled")?($(this).parent().prev().css("height","74px"),$(this).removeClass("toggled")):($(this).parent().prev().css("height","auto"),$(this).addClass("toggled"))}),$(window).scroll(function(){var a=$(document).height()-$(window).height()-$(window).scrollTop();200>=a&&!isEnd&&!isLoading&&3>get_page_times&&(isLoading=!0,$(".feeds-ctn").append('<div class="loading"><img src="/static/images/loading.gif" /></div>'),MM.ajaxPost("ajax_get_feeds",{page_num:cur_page_no+get_page_times,search_type:search_type},function(a){$(".feeds-ctn .loading").remove();var b=generateItems(a.data);$(".feeds-ctn").append($("#feedItemTmpl").tmpl(b)),isLoading=!1,get_page_times++,b.length<10&&(isEnd=!0)}))})}function setPaginaviBar(a){MM.ajaxPost("/get_feeds_count",{search_type:a},function(b){var c=b.data%30,d=Math.floor(b.data/30);$("#pagination").myPagination({pageCount:c?d+1:d,pageNumber:10,cssStyle:"ztmhs",ajax:{on:!1,onClick:function(b){var c=b;c=1==b?1:3*(b-1)+1,cur_page_no=c,get_page_times=1,MM.ajaxPost("ajax_get_feeds",{page_num:c,search_type:a},function(a){var b=generateItems(a.data);$(".feeds-ctn").html($("#feedItemTmpl").tmpl(b)),$(window).scrollTop(500)})}}})})}function generateItems(a){for(var b=0,c=a.length;c>b;b++)a[b].cat=a[b].cat[0],a[b].our_cat=cat_dict[a[b].our_cat],a[b].descData=JSON.stringify({url:"http://www.ztmhs.com/redirect/?"+a[b].img_link_id,pic:a[b].img.indexOf("http://")<0?"http://www.ztmhs.com"+a[b].img:a[b].img,title:a[b].title,text:a[b].desc[0],desc:"全网性价比商品哪里找？秒杀宝贝时时有？真划算帮你实现，传送门：http://www.ztmhs.com"}),a[b].title=setHotTitle(a[b].title,a[b].flush),a[b].desc=makeProductLink(a[b].desc,a[b].desc_link);return a}function setHotTitle(a,b){for(var c=0,d=b.length;d>c;c++){var e=$.trim(b[c]);a=a.replace(e,"<strong>"+e+"</strong>")}return a}function makeProductLink(a,b){for(var c="",d=0,e=a.length;e>d;d++)c=c+"<p>"+a[d]+"</p>";for(var d=0,e=b.length;e>d;d++)c=c.replace(b[d][0],'<a target="_blank" href="/redirect/?'+b[d][1]+'">'+b[d][0]+"</a>");return c}var mm=require("./base");require("myPagination");var pub={},search_type=0,isLoading=!1,isEnd=!1,cur_page_no=1,get_page_times=1,cat_dict={0:"全部",1:"白菜价",2:"强烈值得买",3:"促销活动"};pub.init=function(){setPaginaviBar(0),initEvent()},module.exports=pub});